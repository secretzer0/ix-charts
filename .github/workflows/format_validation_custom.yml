name: catalog_validation_custom

on:
  push:
  workflow_dispatch:

jobs:
  ix-validate:
    runs-on: ubuntu-latest

    # This workflow uses our custom Docker image
    # To activate: 
    # 1. Build and publish the Docker image (see docker/README.md)
    # 2. Rename this file to format_validation.yml (replacing the original)
    container:
      # Using our forked validation tools from GitHub Container Registry
      image: ghcr.io/secretzer0/ix_catalog_validation:latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Adding git directory to safe path
        run: git config --global --add safe.directory "$(pwd)"
      - name: Fetch base branch history
        run: git fetch -u origin main:main
      - name: validate catalog
        run: /bin/bash -c "catalog_validate validate --path $(pwd)"